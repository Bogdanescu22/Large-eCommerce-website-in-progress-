"use strict";(self.webpackChunkfornt_end=self.webpackChunkfornt_end||[]).push([[52],{52:(t,e,a)=>{a.r(e),a.d(e,{default:()=>l});var i=a(43),s=a(276),n=a(334),r=a(579);const c=function(t){let{imgURL:e,title:a,quantity:s,price:n,onStockCheck:c,user_id:l,onDelete:o,updateTotal:d}=t;const[u,h]=(0,i.useState)(null),[p,f]=(0,i.useState)(s),[j,x]=(0,i.useState)(null),[g,m]=(0,i.useState)(null);(0,i.useEffect)((()=>{fetch("https://api.devsite.cfd/products").then((t=>t.json())).then((t=>{const a=t.find((t=>t.image_url===e));a?(h(a.stock),x(a.id),console.log("\ud83d\udccc productID setat:",a.id)):(h(0),x(null),console.log("\u274c productID este null!"))})).catch((t=>console.log("Eroare la fetch",t)))}),[e]);const w=s>u?"indisponibil":"disponibil";(0,i.useEffect)((()=>{c(e,w)}),[e,w]);const v=t=>{j&&l&&fetch(`https://api.devsite.cfd/cart/quantity/update/${j}/${l}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:t}),credentials:"include"}).then((t=>t.json())).then((e=>{d(n,t>p),console.log("\u2705 R\u0103spuns server:",e)})).catch((t=>console.log("\u274c Eroare la actualizarea cantit\u0103\u021bii:",t)))};return(0,r.jsxs)("div",{className:"cart-card "+(g?"active":""),children:[(0,r.jsx)("div",{className:"image-CartCard-div",children:(0,r.jsx)("img",{className:"image-CartCard",src:e,alt:a})}),(0,r.jsxs)("div",{className:"title-quantity-CartCard",children:[(0,r.jsx)("h2",{className:"title-CartCard",children:a}),(0,r.jsxs)("div",{className:"quantity-CartCard",children:[(0,r.jsx)("span",{className:"add-quantity",children:(0,r.jsx)("button",{onClick:()=>{const t=p+1;f(t),v(t)},children:(0,r.jsxs)("svg",{width:"17",height:"13",viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("rect",{width:"10",height:"40",x:"15",fill:"#afb1b8"}),(0,r.jsx)("rect",{width:"40",height:"10",y:"15",fill:"#afb1b8"})]})})}),"Cantitate: ",p,(0,r.jsx)("span",{className:"minus-quantity",children:(0,r.jsx)("button",{onClick:()=>{if(p>1){const t=p-1;f(t),v(t)}},children:(0,r.jsx)("svg",{width:"15",height:"10",viewBox:"0 0 40 10",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("rect",{width:"40",height:"10",rx:"2",fill:"#afb1b8"})})})})]})]}),(0,r.jsxs)("div",{className:"price-disponibility-CartCard",children:[(0,r.jsxs)("h2",{className:"price-CartCard",children:["$",n]}),(0,r.jsx)("p",{className:"indisponibil"===w?"indisponibil":"disponibil",children:"indisponibil"===w?"Nu e disponibil \xeen cantitatea selectat\u0103":"Disponibil \xeen cantitatea selectat\u0103"})]}),(0,r.jsx)("div",{className:"cart-delete-button",children:(0,r.jsx)("button",{onClick:()=>{fetch(`https://api.devsite.cfd/cart/delete/${l}/${j}`,{method:"DELETE",credentials:"include"}).then((t=>t.json())).then((t=>{console.log("\u2705 R\u0103spuns server (\u0218tergere):",t),o(j),m(!0)})).catch((t=>console.log("Eroare la stergerea produsului:",t)))},children:"X"})})]})};const l=function(){const[t,e]=(0,i.useState)([]),[a,l]=(0,i.useState)(null),[o,d]=(0,i.useState)(null),[u,h]=(0,i.useState)({});function p(t,e){h((a=>({...a,[t]:e})))}(0,i.useEffect)((()=>{(async()=>{try{const t=await fetch("https://api.devsite.cfd/auth/user",{credentials:"include"});if(!t.ok)throw new Error("Eroare la ob\u021binerea utilizatorului");const e=await t.json();e.user?l(e.user.id):alert("Nu e\u0219ti autentificat")}catch(t){console.error("Eroare:",t)}})()}),[a]),(0,i.useEffect)((()=>{if(!a)return;(async()=>{try{const t=await fetch(`https://api.devsite.cfd/cart/data/${a}`,{credentials:"include"});if(!t.ok)throw new Error("Eroare la ob\u021binerea produselor din co\u0219");const i=await t.json();e(i)}catch(t){console.error("\u274c Eroare la ob\u021binerea produselor din co\u0219:",t)}})()}),[a]),(0,i.useEffect)((()=>{a&&0!==t.length?fetch(`https://api.devsite.cfd/cart/total/${a}`,{credentials:"include"}).then((t=>{if(!t.ok)throw new Error("Eroare la preluarea totalului co\u0219ului");return t.json()})).then((t=>{d(void 0!==t.total?t.total:0)})).catch((t=>console.error("Eroare la fetch:",t))):d(0)}),[a,t]);const f=Object.values(u).includes("indisponibil"),j=t=>{e((e=>e.filter((e=>e.product_id!==t))))},x=(t,e)=>{d((a=>e?parseFloat(a)+parseFloat(t):parseFloat(a)-parseFloat(t)))};return(0,r.jsxs)("div",{className:"cartPage",children:[(0,r.jsx)(s.A,{}),(0,r.jsx)("main",{children:(0,r.jsxs)("div",{className:"cart-cards-div",children:[t.length>0?t.map((t=>(0,r.jsx)(c,{user_id:t.user_id,imgURL:t.img_url,title:t.product_name,quantity:t.quantity,price:t.product_price,onStockCheck:p,onDelete:j,updateTotal:x},t.id))):(0,r.jsx)("p",{children:"Co\u0219ul t\u0103u este gol!"}),(0,r.jsx)("div",{className:"total-CartPage-div",children:(0,r.jsxs)("h2",{className:"total-CartPage",children:["Total: $",o]})}),(0,r.jsx)("button",{className:"button-CartPage",onClick:()=>{f?alert("Produsele nu sunt disponibile \xeen cantitatea aleas\u0103!"):window.location.href="https://www.devsite.cfd/telefoane/checkout"},children:"Finalizare Comand\u0103"})]})}),(0,r.jsx)(n.A,{})]})}}}]);
//# sourceMappingURL=52.0f027fb3.chunk.js.map