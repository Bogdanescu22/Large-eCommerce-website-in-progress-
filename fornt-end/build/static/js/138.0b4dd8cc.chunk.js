"use strict";(self.webpackChunkfornt_end=self.webpackChunkfornt_end||[]).push([[138],{138:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var i=s(43),r=s(276),c=s(334),a=s(579);const n=function(e){let{imgURL:t,title:s,product_quantity:i,product_price:r}=e;return(0,a.jsxs)("div",{className:"details-card",children:[(0,a.jsxs)("div",{className:"image-text-details-div",children:[(0,a.jsx)("div",{className:"details-card-img-div",children:(0,a.jsx)("img",{src:t,alt:s})}),(0,a.jsxs)("div",{className:"details-card-text-div",children:[(0,a.jsx)("h2",{className:"details-card-title",children:s}),(0,a.jsxs)("p",{className:"details-card-price",children:["$",r]})]})]}),(0,a.jsx)("div",{className:"quantity-details-div",children:(0,a.jsxs)("p",{children:["x",i]})})]})},l=()=>{const[e,t]=(0,i.useState)({}),[s,r]=(0,i.useState)([]);return(0,i.useEffect)((()=>{fetch("https://api.devsite.cfd/auth/user",{credentials:"include"}).then((e=>{if(!e.ok)throw new Error("Eroare la ob\u021binerea utilizatorului");return e.json()})).then((e=>{let{user:s}=e;return t(s)})).catch((e=>console.error("Eroare:",e)))}),[]),(0,i.useEffect)((()=>{console.log("User ID \xeenainte de fetch:",e.id),e.id?fetch(`https://api.devsite.cfd/orders_fetch/${e.id}`,{credentials:"include"}).then((e=>e.json())).then((e=>{console.log("R\u0103spuns server orders_fetch:",e);const t=e.reduce(((e,t)=>(e[t.order_id]||(e[t.order_id]={order_id:t.order_id,total_price:t.total_price,products:[]}),e[t.order_id].products.push({product_id:t.product_id,product_name:t.product_name,product_price:t.product_price,image_url:t.image_url,quantity:t.quantity}),e)),{});r(Object.values(t))})).catch((e=>console.error("Eroare:",e))):console.log("ID-ul utilizatorului nu este definit.")}),[e.id]),(0,a.jsx)("div",{className:"account-details-card-div1",children:s.map((e=>(0,a.jsxs)("div",{className:"account-details-card-div2",children:[(0,a.jsxs)("div",{className:"account-details-card-div-h2",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("h2",{children:["Id comanda: #",(0,a.jsx)("span",{children:e.order_id})]})}),(0,a.jsx)("div",{className:"account-details-card-div-h2-total",children:(0,a.jsxs)("h2",{children:["Total: ",(0,a.jsxs)("span",{children:["$",e.total_price]})]})})]}),(0,a.jsx)("div",{className:"account-details-card",children:e.products.map((e=>(0,a.jsx)(n,{imgURL:e.image_url,title:e.product_name,product_price:e.product_price,product_quantity:e.quantity},e.product_id)))})]},e.order_id)))})};const d=function(e){let{imageSrc:t,onSave:s,onClose:r,user_id:c}=e;const[n,l]=(0,i.useState)(1),[d,o]=(0,i.useState)({x:0,y:0}),[u]=(0,i.useState)({width:200,height:200,x:50,y:50}),h=(0,i.useRef)(null),p=(0,i.useRef)(null),x=(0,i.useRef)(!1),m=(0,i.useRef)({x:0,y:0}),j=()=>{x.current=!1};return(0,a.jsxs)("div",{className:"cropper-overlay",children:[(0,a.jsxs)("div",{className:"cropper-container",children:[(0,a.jsxs)("div",{className:"cropper-frame",onMouseDown:e=>{e.preventDefault(),x.current=!0,m.current={x:e.clientX,y:e.clientY}},onMouseMove:e=>{if(!x.current)return;const t=e.clientX-m.current.x,s=e.clientY-m.current.y;console.log("Deltax",t),console.log("Deltay",s),console.log("Clientx",e.clientX),console.log("Clienty",e.clientY),console.log("startx:",m.current.x),console.log("starty:",m.current.y),o((e=>({x:e.x+t,y:e.y+s}))),console.log("Positionx",d.x),console.log("Positiony",d.y),m.current={x:e.clientX,y:e.clientY},console.log("Startpos2",m.current)},onMouseUp:j,onMouseLeave:j,children:[(0,a.jsx)("img",{ref:h,src:t,alt:"To crop",className:"croppable-image",style:{transform:`translate(${d.x}px, ${d.y}px) scale(${n})`,cursor:"grab"}}),(0,a.jsx)("div",{className:"cropper-box",style:{position:"absolute",top:u.y,left:u.x,width:u.width,height:u.height,border:"2px dashed red",pointerEvents:"none"}})]}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:n,onChange:e=>l(Number(e.target.value))}),(0,a.jsx)("button",{onClick:()=>{const e=p.current,t=e.getContext("2d"),i=h.current;e.width=u.width,e.height=u.height;const r=d.x,a=d.y,l=(u.x-r)/n,o=(u.y-a)/n,x=u.width,m=u.height;t.drawImage(i,l,o,x,m,0,0,u.width,u.height),e.toBlob((async e=>{if(!e)return;const t=new FormData;t.append("profile_picture",e);try{const e=await fetch(`https://api.devsite.cfd/profile-picture/addPicture/${c}`,{method:"PATCH",body:t,credentials:"include"}),i=await e.json();i.imageUrl&&s(i.imageUrl)}catch(i){console.error("Eroare la \xeenc\u0103rcarea imaginii:",i)}}),"image/webp")},children:"Salveaz\u0103"}),(0,a.jsx)("button",{onClick:r,children:"Anuleaz\u0103"})]}),(0,a.jsx)("canvas",{ref:p,style:{display:"none"}})]})};var o=s(799);const u=function(){const[e,t]=(0,i.useState)(null),[s,n]=(0,i.useState)([]),[u,h]=(0,i.useState)(null),[p,x]=(0,i.useState)(!1),[m,j]=(0,i.useState)(null);return(0,o.Zp)(),(0,i.useEffect)((()=>{p?document.body.classList.add("no-scroll"):document.body.classList.remove("no-scroll")}),[p]),(0,i.useEffect)((()=>{fetch("https://api.devsite.cfd/auth/user",{credentials:"include"}).then((e=>e.json())).then((e=>{let{user:s}=e;t(s)})).catch((e=>{console.error("Eroare:",e),h("Eroare la \xeenc\u0103rcarea datelor utilizatorului")}))}),[]),(0,i.useEffect)((()=>{e&&e.id&&fetch(`https://api.devsite.cfd/orders_fetch/${e.id}`,{credentials:"include"}).then((e=>e.json())).then((e=>n(e))).catch((e=>console.error("Eroare:",e)))}),[e]),e?(0,a.jsxs)("div",{className:"account-details-page "+(p?"activeChange":""),children:[p&&(0,a.jsx)("div",{className:"blur-overlay",children:(0,a.jsxs)("div",{className:"add-picture-div",children:[(0,a.jsxs)("div",{className:"add-picture-title-close-button-div",children:[(0,a.jsx)("h3",{children:"Pozitiona\u021bi \u0219i redimensiona\u021bi imaginea"}),(0,a.jsx)("button",{onClick:()=>x(!1),children:"X"})]}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files[0]&&j(URL.createObjectURL(e.target.files[0]))}}),m&&(0,a.jsx)(d,{user_id:e.id,imageSrc:m,onSave:e=>{t((t=>({...t,profile_picture:e}))),x(!1)},onClose:()=>j(null)})]})}),(0,a.jsx)(r.A,{}),(0,a.jsxs)("main",{children:[(0,a.jsxs)("div",{className:"details-div",children:[(0,a.jsx)("h1",{children:"Detalii cont:"}),(0,a.jsxs)("div",{className:"user-profile-photo-div",children:[(0,a.jsxs)("div",{className:"picture-div",children:[(0,a.jsx)("img",{src:e.profile_picture?`https://api.devsite.cfd${e.profile_picture}`:"/default-profile.png",alt:"Profil"}),(0,a.jsx)("span",{onClick:()=>x(!0),children:"\u270f\ufe0f"})]}),(0,a.jsx)("button",{onClick:()=>{e&&e.id&&fetch(`https://api.devsite.cfd/profile-picture/delete/${e.id}`,{credentials:"include",method:"DELETE"}).then((e=>e.json())).then((()=>{t((e=>({...e,profile_picture:null})))})).catch((e=>console.error("Eroare la \u0219tergere:",e)))},children:"\u0218terge fotografia"})]}),(0,a.jsxs)("p",{children:["Nume utilizator: ",(0,a.jsx)("span",{children:e.displayname})]}),(0,a.jsxs)("p",{children:["ID utilizator: ",(0,a.jsx)("span",{children:e.id})]}),(0,a.jsxs)("p",{children:["Adresa: ",(0,a.jsx)("span",{children:e.address||"N/A"})]})]}),(0,a.jsx)("button",{onClick:()=>window.location.href="https://api.devsite.cfd/logout",children:"Logout"}),u&&(0,a.jsx)("div",{className:"error-message",children:u}),(0,a.jsxs)("div",{className:"details-orders-history-div",children:[(0,a.jsx)("h2",{children:"Istoric comenzi:"}),(0,a.jsx)("div",{className:"orders-history-cards-div",children:(0,a.jsx)(l,{})})]})]}),(0,a.jsx)(c.A,{})]}):(0,a.jsx)("div",{children:"Se \xeencarc\u0103..."})}}}]);
//# sourceMappingURL=138.0b4dd8cc.chunk.js.map